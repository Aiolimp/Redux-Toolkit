## **Redux æ˜¯ä»€ä¹ˆï¼Ÿ**

- Redux æ˜¯ä¸€ä¸ª**çŠ¶æ€ç®¡ç†åº“**ã€‚

- ä¸»è¦ç”¨äº**ç®¡ç†å¤æ‚åº”ç”¨ä¸­å¤šä¸ªç»„ä»¶å…±äº«çš„çŠ¶æ€**ã€‚

- æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

  ğŸ‘‰ æ‰€æœ‰çš„çŠ¶æ€è¢«æ”¾åœ¨ä¸€ä¸ª**ç»Ÿä¸€çš„ Store**ä¸­ï¼Œä»»ä½•ç»„ä»¶éƒ½å¯ä»¥è®¿é—®å®ƒï¼Œè€Œä¸æ˜¯è®©çŠ¶æ€åˆ†æ•£åœ¨å„ç»„ä»¶å†…éƒ¨

  ä¸­æ–‡æ–‡æ¡£ï¼šhttps://www.redux.org.cn/

## **æ ¸å¿ƒæ¦‚å¿µ**

| **æ¦‚å¿µ**     | **è§£é‡Š**                                                       |
| ------------ | -------------------------------------------------------------- |
| **Store**    | ç»Ÿä¸€ä¿å­˜åº”ç”¨çŠ¶æ€çš„åœ°æ–¹ã€‚æ•´ä¸ª App æœ‰ä¸”åªæœ‰ä¸€ä¸ª Storeã€‚          |
| **State**    | Store é‡Œå­˜çš„æ•°æ®ã€‚æ˜¯ä¸€ä¸ª**åªè¯»çš„å¯¹è±¡æ ‘**ã€‚                     |
| **Action**   | ä¸€ä¸ªæè¿°**â€œè¦åšä»€ä¹ˆâ€**çš„æ™®é€šå¯¹è±¡ï¼Œå¿…é¡»æœ‰ type å­—æ®µã€‚           |
| **Reducer**  | ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ¥æ”¶å½“å‰çš„ state å’Œ actionï¼Œè¿”å›æ–°çš„ stateã€‚       |
| **Dispatch** | è§¦å‘ actionï¼Œå‘Šè¯‰ Storeï¼šâ€œæˆ‘è¦æ”¹å˜çŠ¶æ€äº†â€ã€‚                    |
| **Selector** | ç”¨æ¥ä» Store ä¸­**è¯»å–/é€‰æ‹©ç‰¹å®šæ•°æ®**çš„æ–¹æ³•ã€‚ï¼ˆå¦‚ useSelectorï¼‰ |

## **Redux å·¥ä½œæµç¨‹ï¼ˆRedux Flowï¼‰**

âš¡ **ä» dispatch åˆ° reducer åˆ° state å†åˆ° UI æ›´æ–°**ï¼Œæ•´ä½“æµç¨‹ï¼š

```tex
UIç•Œé¢ -> æ´¾å‘ dispatch(action) -> reducerå¤„ç† -> ç”Ÿæˆæ–°çš„state -> é€šçŸ¥UIæ›´æ–°
```

è¯¦ç»†æ‹†è§£ï¼š

1. **ç”¨æˆ·æ“ä½œ**ï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ï¼‰
2. **ç»„ä»¶è°ƒç”¨ dispatch(action)**ï¼Œæ´¾å‘ä¸€ä¸ª actionï¼ˆaction æ˜¯ä¸€ä¸ªç®€å•çš„ JS å¯¹è±¡ï¼‰
3. **Redux Store** æ”¶åˆ° action åï¼Œè°ƒç”¨å¯¹åº”çš„ **reducer**
4. **Reducer** æ ¹æ® action çš„ type å’Œ payloadï¼Œè¿”å›ä¸€ä¸ª**æ–°çš„ state**
5. **Store æ›´æ–°è‡ªå·±çš„ state**ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰**è®¢é˜…äº†çš„ç»„ä»¶**
6. **ç»„ä»¶ä½¿ç”¨ useSelector**ï¼Œé‡æ–°æ‹¿åˆ°æœ€æ–°çš„ stateï¼Œå®Œæˆ UI æ›´æ–°

## **Redux Toolkit**

**Redux Toolkit** æ˜¯å®˜æ–¹æ¨èçš„ç¼–å†™ Redux é€»è¾‘çš„æ–¹æ³•ã€‚`@reduxjs/toolkit` åŒ…å°è£…äº†æ ¸å¿ƒçš„ `redux` åŒ…ï¼ŒåŒ…å«æˆ‘ä»¬è®¤ä¸ºæ„å»º Redux åº”ç”¨æ‰€å¿…é¡»çš„ API æ–¹æ³•å’Œå¸¸ç”¨ä¾èµ–ã€‚ Redux Toolkit é›†æˆäº†æˆ‘ä»¬å»ºè®®çš„æœ€ä½³å®è·µï¼Œç®€åŒ–äº†å¤§éƒ¨åˆ† Redux ä»»åŠ¡ï¼Œé˜»æ­¢äº†å¸¸è§é”™è¯¯ï¼Œå¹¶è®©ç¼–å†™ Redux åº”ç”¨ç¨‹åºå˜å¾—æ›´å®¹æ˜“ã€‚

Redux Toolkit æ–‡æ¡£ï¼šhttps://redux-toolkit.js.org/

### configureStore

åˆ›å»º Redux Store çš„ç®€åŒ–æ–¹æ³•ï¼Œè‡ªåŠ¨é›†æˆäº† Redux DevTools å’Œä¸€äº›é»˜è®¤ä¸­é—´ä»¶ã€‚

- è‡ªåŠ¨åˆå¹¶å¤šä¸ª slice reducer
- é»˜è®¤é›†æˆ redux-thunk ä¸­é—´ä»¶

```ts
import { configureStore } from '@reduxjs/toolkit';
import counterReducer from './features/counterSlice';
import userReducer from './features/userSlice';

export const store = configureStore({
  reducer: {
    counter: counterReducer,
    user: userReducer,
  },
});

// æ¨å¯¼ RootState å’Œ AppDispatch ç±»å‹
export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
```

### createSlice

ç®€æ´åœ°å®šä¹‰ stateã€reducers å’Œè‡ªåŠ¨ç”Ÿæˆçš„ actionsã€‚

- è‡ªåŠ¨ç”Ÿæˆ action creators å’Œ action types
- æ”¯æŒ immerï¼Œç›´æ¥ä¿®æ”¹ state çœ‹èµ·æ¥æ˜¯â€œå¯å˜çš„â€ï¼Œä½†å…¶å®æ˜¯ä¸å¯å˜æ›´æ–°

```ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit';

interface CounterState {
  value: number;
}

const initialState: CounterState = { value: 0 };

const counterSlice = createSlice({
  name: 'counter',
  initialState,
  reducers: {
    increment: (state) => {
      state.value += 1;
    },
    decrement: (state) => {
      state.value -= 1;
    },
    addByAmount: (state, action: PayloadAction<number>) => {
      state.value += action.payload;
    },
  },
});

export const { increment, decrement, addByAmount } = counterSlice.actions;
export default counterSlice.reducer;
```

## **React-redux**

react-redux æ˜¯ React å®˜æ–¹æ¨èçš„ Redux ç»‘å®šåº“ï¼Œå®ƒçš„ä½œç”¨æ˜¯ **æŠŠ Redux çŠ¶æ€ç®¡ç†ç³»ç»Ÿè¿æ¥åˆ° React ç»„ä»¶ä¸­**ï¼Œè®©ä½ å¯ä»¥åœ¨ React ç»„ä»¶é‡Œè½»æ¾è¯»å– store å’Œè§¦å‘ actionã€‚

### **Provider**ï¼šè¿æ¥ Redux Store ä¸ React

Provider æ˜¯ react-redux æä¾›çš„ä¸€ä¸ªç»„ä»¶ï¼Œä½œç”¨æ˜¯ï¼š**å°† Redux çš„ store ä¼ å…¥ React åº”ç”¨çš„ä¸Šä¸‹æ–‡ä¸­**ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨ä»»ä½•å­ç»„ä»¶ä¸­ä½¿ç”¨ **useSelector** å’Œ **useDispatch** è®¿é—® **state** å’Œ **dispatch actions**ã€‚

é€šå¸¸åœ¨é¡¹ç›®çš„å…¥å£æ–‡ä»¶ï¼ˆæ¯”å¦‚ main.jsx æˆ– index.tsxï¼‰ä¸­ä½¿ç”¨å®ƒï¼š

```ts
import React from 'react';
import ReactDOM from 'react-dom/client';
import { Provider } from 'react-redux';
import App from './App';
import store from './store'; // ä½ ç”¨ configureStore åˆ›å»ºçš„ store

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

### **useSelector**ï¼šä» Redux Store ä¸­è¯»å–çŠ¶æ€

useSelector æ˜¯ä¸€ä¸ª hookï¼Œç”¨äº**è¯»å– Redux store ä¸­çš„æŸä¸€éƒ¨åˆ† state**ã€‚

```ts
import { useSelector } from 'react-redux';
import { RootState } from './store';

const Counter = () => {
  const count = useSelector((state: RootState) => state.counter.value);
  return <div>Count: {count}</div>;
};
```

**ç‰¹ç‚¹ï¼š**

- è‡ªåŠ¨è®¢é˜… state å˜åŒ–ã€‚
- è¿”å›å€¼å‘ç”Ÿå˜åŒ–æ‰ä¼šè§¦å‘ç»„ä»¶é‡æ¸²æŸ“ã€‚
- ç±»å‹å®‰å…¨ï¼ˆé…åˆ TypeScript ä½¿ç”¨ RootState ç±»å‹ï¼‰ã€‚
- åªèƒ½åœ¨ Provider åŒ…è£¹çš„ç»„ä»¶æ ‘ä¸­ä½¿ç”¨ã€‚

### useDispatchï¼šè§¦å‘ Redux Action

**useDispatch** æ˜¯ä¸€ä¸ª hookï¼Œç”¨æ¥è·å– Redux ä¸­çš„ **dispatch å‡½æ•°**ï¼Œç„¶åé€šè¿‡å®ƒ**åˆ†å‘ä¸€ä¸ª action** æˆ– **å¼‚æ­¥çš„ thunk**ã€‚

**ä½¿ç”¨æ–¹å¼ï¼ˆåŒæ­¥å’Œå¼‚æ­¥éƒ½è¡Œï¼‰**

```ts
import { useDispatch } from 'react-redux';
import { increment } from './counterSlice';

const Counter = () => {
  const dispatch = useDispatch();

  return <button onClick={() => dispatch(increment())}>+1</button>;
};
```

**ç»“åˆå¼‚æ­¥ createAsyncThunk**

```ts
import { fetchUserById } from './userSlice';

const UserLoader = () => {
  const dispatch = useDispatch();
  const loadUser = () => {
    dispatch(fetchUserById(1)); // dispatch å¼‚æ­¥ action
  };
  return <button onClick={loadUser}>åŠ è½½ç”¨æˆ·</button>;
};
```

## **ç®€å•ä»£ç ç¤ºä¾‹ï¼ˆæœ€æ–° Redux Toolkit å†™æ³•ï¼‰**

ğŸ”µ **Counter ç¤ºä¾‹**

**counterSlice.js**

```js
import { createSlice } from '@reduxjs/toolkit';
// createSlice ç”Ÿæˆ actions å’Œ reducer
const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    increment(state) {
      state.value += 1;
    },
    decrement(state) {
      state.value -= 1;
    },
  },
});
export const { increment, decrement } = counterSlice.actions;
export default counterSlice.reducer;
```

**store.js**

```jsx
import { configureStore } from '@reduxjs/toolkit';
import counterReducer from './counterSlice';
// configureStore æ³¨å†Œ reducer
export const store = configureStore({
  reducer: {
    counter: counterReducer,
  },
});
```

**App.jsx**

```jsx
import { useSelector, useDispatch } from 'react-redux';
import { increment, decrement } from './counterSlice';

function App() {
  // è¯»å–æ•°æ®
  const count = useSelector((state) => state.counter.value);
  // å‘é€åŠ¨ä½œ
  const dispatch = useDispatch();

  return (
    <div>
      <h1>{count}</h1>
      <button onClick={() => dispatch(increment())}>åŠ 1</button>
      <button onClick={() => dispatch(decrement())}>å‡1</button>
    </div>
  );
}

export default App;
```

### æ³¨æ„ç‚¹

- Reducer å¿…é¡»æ˜¯**çº¯å‡½æ•°**ï¼šä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼ˆä½†ç”¨ Redux Toolkit çš„ immer å¯ä»¥çœ‹èµ·æ¥â€œç›´æ¥ä¿®æ”¹â€ï¼Œå…¶å®æ˜¯æ‹·è´äº†ï¼‰ã€‚
- Action æ˜¯æè¿°äº‹ä»¶ï¼Œä¸æ˜¯æ‰§è¡Œé€»è¾‘ã€‚
- Redux åªç®¡ç†**çŠ¶æ€**ï¼Œ**å‰¯ä½œç”¨ï¼ˆå¼‚æ­¥ï¼‰**éœ€è¦ç»“åˆ redux-thunk æˆ– redux-sagaï¼ˆä¸è¿‡ Redux Toolkit å·²ç»å†…ç½® thunk æ”¯æŒäº†ï¼‰ã€‚
